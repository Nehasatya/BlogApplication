<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>

<p>
  <strong>Topic</strong>
  <%= @topic.title %>
</p>
<p> Post </p>
  <p>
  <strong>Post title</strong>
  <%= @post.title %>
  </p>

  <p>
  <strong>Post About</strong>
  <%= @post.description %>
  </p>

  <p>
  <strong>Author Name</strong>
  <%= @post.author_name %>
  </p>

<strong>Tags:</strong>
<%= @post.tags.each do |tag| %>
  <%= link_to tags_index_url do%>
    <span><%= tag.name %></span>
  <%end %>
<%end %>


<p>Comments</p>
  <% @comments.each do |comment| %><br>
  <div class="comments" data-comment-id = "<%=comment.id%>">
      <p><%= comment.com_description %><br>
        <%= comment.author_name %><br>
        <% if can? :update, comment %>
        <%= link_to 'Edit', edit_topic_post_comment_path( {topic_id: @topic.id, post_id: @post.id, id: comment.id, comment: @comment}) %>
        <%= link_to 'Destroy', [@topic, @post, comment], method: :delete, data: { confirm: 'Are you sure?' } %></p>
          <div id = "rate-<%=comment.id%>">Rate</div>
          <div id = "rate-form-<%=comment.id%>" style="visibility: hidden">
            <%= render 'comments/ratings_form' , user_comment_rating: comment.user_comment_ratings.new, comment: comment %>
         </div>
          <%= link_to 'Show Ratings', "/comments/#{comment.id}/show_ratings"%>
  </div>
  <% end %>
<%end %>
<% if @post.image.attached? %>
  <image src = "<%= url_for(@post.image) %>"></image>
  <%end %>

<p>
  <%count = stars_count(@post)%>
  <% for i in (1..5) do %>
    <%= i %> stars -
    <%= count[i]%><br>
  <% end %>
</p>

<% @rating = @post.ratings.new %>
<%= render 'ratings/form' , post: @post, topic: @topic, rating: @rating%>

<% @comment = Comment.new %>
<%= render 'comments/form', comment: @comment %>



<% if can? :update, @post %>
<%= link_to 'Edit', edit_topic_post_path(@topic, @post) %> |
  <%end %>
<%= link_to 'Back', topic_posts_path %>

<script>

  var comment = document.querySelectorAll('.comments');

  comment.forEach((rate) => {
      var comment_id = rate.getAttribute('data-comment-id');
      const rate_button = document.getElementById(`rate-${comment_id}`);
      const rate_form = document.getElementById(`rate-form-${comment_id}`);

      rate_button.addEventListener('click', () =>{
          console.log("Rate button clicked!!");
          rate_form.style.visibility = 'visible'
      })
  });


</script>